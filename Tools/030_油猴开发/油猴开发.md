* [【轻松上手】油猴脚本开发](https://juejin.cn/post/7022654292880424991#heading-3)

* [哔哩哔哩视频](https://www.bilibili.com/video/BV1qNzdYsEvi?buvid=Y849478223D479B14CA4BDA5DC95C79395BE&from_spmid=main.space.0.0&is_story_h5=false&mid=KCDIM1tFvk8x3T1lWaCGGA%3D%3D&plat_id=116&share_from=ugc&share_medium=iphone&share_plat=ios&share_session_id=D0154399-71EC-4BF9-BEF6-2FB5380C0152&share_source=WEIXIN&share_tag=s_i&spmid=united.player-video-detail.0.0&timestamp=1733049725&unique_k=rS7IaWP&up_id=371312151&vd_source=dc55c355e9f5b6174832aacfb5d8b6aa)



# 油猴（Tampermonkey）详细介绍

## 1. 什么是油猴？

**油猴**（Tampermonkey）是一款流行的**用户脚本管理器**浏览器扩展，它允许用户安装和管理 JavaScript 脚本，从而自定义网页的功能和外观。

## 2. 主要功能

### 脚本管理功能
```javascript
// 示例：简单的用户脚本
// ==UserScript==
// @name         示例脚本
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  这是一个示例脚本
// @author       You
// @match        https://*.example.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    // 你的代码在这里
    console.log('油猴脚本已运行！');
})();
```

### 支持的浏览器
| 浏览器  | 支持情况   | 下载地址          |
| ------- | ---------- | ----------------- |
| Chrome  | ✅ 完全支持 | Chrome 网上应用店 |
| Firefox | ✅ 完全支持 | Firefox Add-ons   |
| Edge    | ✅ 完全支持 | Microsoft Store   |
| Safari  | ✅ 支持     | Safari 扩展库     |

## 3. 安装和使用

### 安装步骤
1. **安装油猴扩展**
   - 访问浏览器扩展商店
   - 搜索 "Tampermonkey"
   - 点击安装

2. **安装用户脚本**
   - 访问脚本网站（如 Greasy Fork、OpenUserJS）
   - 找到需要的脚本
   - 点击"安装"按钮

## 4. 用户脚本开发

### 基本结构
```javascript
// ==UserScript==
// @name         我的自定义脚本
// @namespace    http://your-namespace.com
// @version      1.0
// @description  尝试在某个网站上添加新功能！
// @author       你
// @match        https://www.example.com/*
// @match        https://*.example.org/*
// @exclude      https://admin.example.com/*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_xmlhttpRequest
// @require      https://code.jquery.com/jquery-3.6.0.min.js
// @icon         https://www.google.com/s2/favicons?domain=example.com
// ==/UserScript==

(function() {
    'use strict';
    
    // 等待页面加载完成
    window.addEventListener('load', function() {
        // 在这里编写你的代码
        
        // 示例：修改页面标题
        document.title = '修改后的标题 - ' + document.title;
        
        // 示例：添加自定义按钮
        const button = document.createElement('button');
        button.textContent = '油猴按钮';
        button.style.position = 'fixed';
        button.style.top = '10px';
        button.style.right = '10px';
        button.style.zIndex = '9999';
        button.addEventListener('click', function() {
            alert('油猴脚本被点击了！');
        });
        document.body.appendChild(button);
    });
})();
```

### 常用元数据指令
| 指令           | 说明                 |
| -------------- | -------------------- |
| `@name`        | 脚本名称             |
| `@namespace`   | 命名空间（防止冲突） |
| `@version`     | 版本号               |
| `@description` | 脚本描述             |
| `@match`       | 匹配的URL模式        |
| `@exclude`     | 排除的URL模式        |
| `@grant`       | 请求特殊权限         |
| `@require`     | 引入外部库           |

## 5. 高级功能

### GM_* API 使用
```javascript
// ==UserScript==
// @grant GM_setValue
// @grant GM_getValue
// @grant GM_xmlhttpRequest
// @grant GM_notification
// ==/UserScript==

// 存储数据
GM_setValue('user_preference', 'dark_mode');

// 读取数据
const preference = GM_getValue('user_preference', 'default_value');

// 发送跨域请求
GM_xmlhttpRequest({
    method: 'GET',
    url: 'https://api.example.com/data',
    onload: function(response) {
        console.log('获取到的数据:', response.responseText);
    }
});

// 显示通知
GM_notification({
    text: '脚本执行完成！',
    title: '油猴脚本',
    timeout: 3000
});
```

### 实际应用示例

#### 示例1：网页广告移除
```javascript
// ==UserScript==
// @name         广告移除器
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description  移除常见广告元素
// @author       You
// @match        *://*/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    
    // 移除广告元素
    const adSelectors = [
        '.advertisement',
        '[class*="ad"]',
        '[id*="ad"]',
        'iframe[src*="ads"]',
        '.ad-banner',
        '.google-ad'
    ];
    
    adSelectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(element => {
            element.remove();
        });
    });
})();
```

#### 示例2：视频下载助手
```javascript
// ==UserScript==
// @name         视频下载助手
// @namespace    http://tampermonkey.net/
// @version      1.3
// @description  为视频网站添加下载按钮
// @author       You
// @match        https://www.youtube.com/*
// @match        https://v.qq.com/*
// @grant        GM_download
// ==/UserScript==

(function() {
    'use strict';
    
    function addDownloadButton() {
        const video = document.querySelector('video');
        if (video && !document.getElementById('tm-download-btn')) {
            const downloadBtn = document.createElement('button');
            downloadBtn.id = 'tm-download-btn';
            downloadBtn.textContent = '下载视频';
            downloadBtn.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                padding: 10px;
                background: #ff4444;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            `;
            
            downloadBtn.addEventListener('click', function() {
                const videoSrc = video.src;
                if (videoSrc) {
                    GM_download({
                        url: videoSrc,
                        name: 'downloaded_video.mp4'
                    });
                }
            });
            
            document.body.appendChild(downloadBtn);
        }
    }
    
    // 监听页面变化
    const observer = new MutationObserver(addDownloadButton);
    observer.observe(document.body, { childList: true, subtree: true });
})();
```

## 7. 常用脚本网站

- **Greasy Fork**：最大的用户脚本库
- **OpenUserJS**：开源用户脚本平台
- **GitHub**：开发者分享脚本

